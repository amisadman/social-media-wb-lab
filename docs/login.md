# Login

This document explains how login works, where the code is, and how credentials are validated and stored.

## Flow summary

1. User submits the login form (`POST /login`) from `app/Views/auth/login.php`.
2. `public/index.php` maps the route to `App\Controllers\AuthController::login()`.
3. `AuthController::login()` retrieves the user by email using `App\Models\User::findByEmail()`.
4. The stored password hash is verified using `password_verify()`.
5. On success, user data is saved in the session via `App\Core\Session::set('user', $userData)` and the user is redirected to `/dashboard`.

## Key code (simplified)

AuthController::login (simplified):

```php
// app/Controllers/AuthController.php
$email = trim($_POST['email'] ?? '');
$password = $_POST['password'] ?? '';

$user = User::findByEmail($email);
if ($user && password_verify($password, $user['password'])) {
    Session::set('user', ['id' => $user['id'], 'name' => $user['name'], 'email' => $user['email']]);
    header('Location: /dashboard');
    return;
}

echo 'Invalid credentials.';
```

User::findByEmail returns a row from the `users` table (see `app/Models/User.php`). The `password` field stores a bcrypt hash generated by `password_hash()` at registration.

## Security notes

- Uses `password_hash(..., PASSWORD_BCRYPT)` and `password_verify()` â€” a secure PHP built-in.
- The project stores the user record in `$_SESSION['user']` (id, name, email). Do not store the password in the session.
- For production: use secure cookie settings (`session_set_cookie_params` or framework settings), enable HTTPS, and consider a session store (Redis) for scaled deployments.

## Where to change behavior

- To switch to JWT-based auth, replace `Session::set(...)` with a token creation flow and HTTP-only cookie or Authorization header handling.
- To add throttling/lockouts, add checks before password verification (e.g., log failed attempts by IP and user).
